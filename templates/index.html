{% extends 'layouts/application.html' %}

{% block content %}
  <div class="container has-text-centered">
    <div class="column is-6 is-offset-3">
      <h1 class="title"></h1>
      <h2 class="subtitle"></h2>
    </div>
    <div class="box">
      <div class="field is-grouped">
        <p class="control is-expanded">
          <div class="select is-link">
            <select id="pages">
              {% for page in range(10, 0, -1) %}
                <option value={{page}} selected={{page == 1}} > {{page}} Pages </option>
              {% endfor %}
            </select>
          </div>
          <input class="input" type="text" placeholder="Search ..." id="keyword">
        </p>
        <p class="control">
          <a class="button is-link" id="search">
            Google
          </a>
        </p>
      </div>
    </div>

    <div class="" id="results">
    </div>
  </div>
{% endblock %}

{% block script_content %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script>
    $.ajaxSetup({ contentType: "application/json" });

    $("#keyword").on('keyup', function (event) {
      if (event.keyCode === 13) { $("#search:not(.disabled)").trigger('click'); }
    });

    $("#search:not(.disabled)").on('click', function(event) {
      event.preventDefault();
      var $keyword = $("#keyword").val();
      var $pages = $("#pages").val();
      if ($keyword === '') { return }

      $this = $(this);
      $this.addClass("is-loading disabled");

      // Send the data using post
      $.post(
        '/google',
        JSON.stringify({ 'q': $keyword, 'pages': $pages })
      ).done(function (response) {
        $this.removeClass("is-loading disabled");

        $("#results").html(response);
      });
    });
  </script>
{% endblock %}